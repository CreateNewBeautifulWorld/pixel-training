# Uint8 é‡åŒ–ç¥ç»ç½‘ç»œ - å¿«é€Ÿå…¥é—¨

## ğŸ¯ é¡¹ç›®æ€»è§ˆ

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä»è®­ç»ƒåˆ°RTLå®ç°çš„uint8é‡åŒ–ç¥ç»ç½‘ç»œç¤ºä¾‹ï¼š

**ç½‘ç»œç»“æ„**: 48è¾“å…¥ â†’ 16éšè—å±‚ â†’ 3åˆ†ç±»è¾“å‡º  
**åº”ç”¨åœºæ™¯**: 16åƒç´ å›¾åƒåˆ†ç±»ï¼ˆæ¯åƒç´ RGBï¼Œå…±48ä¸ªuint8è¾“å…¥ï¼‰  
**é‡åŒ–æ–¹å¼**: å…¨uint8ï¼ˆæƒé‡ã€æ¿€æ´»ã€è¾“å…¥å‡ä¸º8-bitï¼‰

## ğŸ“¦ æ–‡ä»¶æ¸…å•

```
â”œâ”€â”€ train_simple.py          # Pythonè®­ç»ƒè„šæœ¬ï¼ˆåŸºäºnumpyï¼‰
â”œâ”€â”€ inference_uint8.cpp      # C++æ¨ç†å¼•æ“
â”œâ”€â”€ inference_uint8          # ç¼–è¯‘å¥½çš„å¯æ‰§è¡Œæ–‡ä»¶
â”œâ”€â”€ uint8_nn_rtl.v          # Verilog RTLå‚è€ƒè®¾è®¡
â”œâ”€â”€ Makefile                # ç¼–è¯‘è„šæœ¬
â”œâ”€â”€ README.md               # è¯¦ç»†æ–‡æ¡£
â”œâ”€â”€ train_data.txt          # è®­ç»ƒæ•°æ®ï¼ˆ1000æ ·æœ¬ï¼‰
â”œâ”€â”€ weights_uint8.bin       # äºŒè¿›åˆ¶æƒé‡æ–‡ä»¶
â””â”€â”€ weights_uint8.bin.txt   # æ–‡æœ¬æƒé‡æ–‡ä»¶ï¼ˆå¯è¯»ï¼‰
```

## ğŸš€ ç«‹å³å¼€å§‹

### æ–¹æ³•1: ç›´æ¥è¿è¡Œå·²ç¼–è¯‘çš„æ¨ç†å¼•æ“

```bash
./inference_uint8
```

è¾“å‡ºï¼š
```
=== Uint8 é‡åŒ–ç¥ç»ç½‘ç»œæ¨ç†å¼•æ“ ===
æƒé‡åŠ è½½æˆåŠŸ!
FC1: [16, 48]
FC2: [3, 16]

--- å•æ ·æœ¬æµ‹è¯• ---
é¢„æµ‹ç±»åˆ«: 1

--- æµ‹è¯•é›†è¯„ä¼° ---
æ€»æ ·æœ¬æ•°: 1000
æ­£ç¡®æ•°: 1000
å‡†ç¡®ç‡: 100%
```

### æ–¹æ³•2: é‡æ–°è®­ç»ƒ

```bash
python train_simple.py
```

è¿™ä¼šï¼š
1. ç”Ÿæˆ1000ä¸ªè®­ç»ƒæ ·æœ¬
2. è®­ç»ƒç¥ç»ç½‘ç»œï¼ˆ100 epochsï¼‰
3. å¯¼å‡ºuint8é‡åŒ–æƒé‡
4. æ˜¾ç¤ºè®­ç»ƒå‡†ç¡®ç‡

### æ–¹æ³•3: é‡æ–°ç¼–è¯‘C++ä»£ç 

```bash
make clean
make
./inference_uint8
```

## ğŸ“Š ç½‘ç»œæ¶æ„è¯¦è§£

```
è¾“å…¥ (48 uint8)
    |
    | 16 pixels Ã— 3 channels (RGB)
    | æ¯ä¸ªå€¼èŒƒå›´: 0-255
    |
    â†“
[å…¨è¿æ¥å±‚1]
    | æƒé‡: [16, 48] uint8
    | åç½®: [16] uint8
    | MAC: sum += input[i] Ã— weight[i]
    | ç¼©æ”¾: result = sum / 256
    | æ¿€æ´»: ReLU(result)
    â†“
éšè—å±‚ (16 uint8)
    |
    | æ¯ä¸ªå€¼èŒƒå›´: 0-255
    |
    â†“
[å…¨è¿æ¥å±‚2]
    | æƒé‡: [3, 16] uint8
    | åç½®: [3] uint8
    | MAC: sum += hidden[i] Ã— weight[i]
    â†“
è¾“å‡º (3 int32)
    |
    | Argmax
    |
    â†“
åˆ†ç±»ç»“æœ (0/1/2)
```

## ğŸ’¡ å…³é”®è®¾è®¡è¦ç‚¹

### 1. é‡åŒ–ç­–ç•¥

**è¾“å…¥**: åƒç´ å€¼æœ¬èº«å°±æ˜¯uint8 (0-255)ï¼Œæ— éœ€é‡åŒ–  
**æƒé‡**: è®­ç»ƒæ—¶æµ®ç‚¹ â†’ å¯¼å‡ºæ—¶é‡åŒ–åˆ°uint8  
**æ¿€æ´»**: ReLUåé‡åŒ–åˆ°uint8èŒƒå›´

### 2. è®¡ç®—ç²¾åº¦

```cpp
// MACç´¯åŠ 
int32_t sum = 0;
for (int i = 0; i < 48; i++) {
    sum += (uint8_t)input[i] * (uint8_t)weight[i];
    // 8bit Ã— 8bit = 16bit
    // ç´¯åŠ 48æ¬¡æœ€å¤§: 255Ã—255Ã—48 = 3,111,600 (éœ€è¦22bit)
}

// ç¼©æ”¾
result = (sum >> 8) + bias;  // é™¤ä»¥256
// ä¸ºä»€ä¹ˆé™¤256ï¼Ÿç¡¬ä»¶å‹å¥½ï¼ˆç§»ä½ï¼‰ï¼Œæ¥è¿‘é™¤255ï¼ˆå½’ä¸€åŒ–ï¼‰
```

### 3. RTLå®ç°é€‰é¡¹

**ä¸²è¡Œå®ç°**ï¼ˆçœèµ„æºï¼‰:
- 1ä¸ªMACå•å…ƒ
- çº¦800ä¸ªæ—¶é’Ÿå‘¨æœŸ
- é€‚åˆFPGA

**å¹¶è¡Œå®ç°**ï¼ˆçœæ—¶é—´ï¼‰:
- 16ä¸ªMACå•å…ƒ
- çº¦1-2ä¸ªæ—¶é’Ÿå‘¨æœŸ
- é€‚åˆé«˜æ€§èƒ½ASIC

## ğŸ”§ è‡ªå®šä¹‰ä½ çš„ç½‘ç»œ

### ä¿®æ”¹è¾“å…¥å°ºå¯¸

ä¾‹å¦‚æ”¹ä¸º4ä¸ªåƒç´ ï¼ˆ12ä¸ªè¾“å…¥ï¼‰ï¼š

```cpp
// inference_uint8.cpp
static const int INPUT_DIM = 12;  // 4 pixels Ã— 3 channels
```

```python
# train_simple.py
model = SimpleNN(input_dim=12, hidden_dim=8, output_dim=3)
```

### ä¿®æ”¹éšè—å±‚å¤§å°

```cpp
static const int HIDDEN_DIM = 32;  // å¢åŠ åˆ°32ä¸ªç¥ç»å…ƒ
```

### ä½¿ç”¨ä½ è‡ªå·±çš„æ•°æ®

åˆ›å»º `my_data.txt`ï¼Œæ ¼å¼ï¼š

```
pixel0_r,pixel0_g,pixel0_b,...,pixel15_b,label
128,64,32,255,...,64,128,255,0
64,128,255,32,...,255,0,128,1
...
```

ç„¶åï¼š

```python
generate_sample_data('my_data.txt', num_samples=5000)  # 5000æ ·æœ¬
```

## ğŸ“ˆ æ€§èƒ½åˆ†æ

### å½“å‰å®ç°

| æŒ‡æ ‡ | å€¼ |
|-----|-----|
| è®­ç»ƒå‡†ç¡®ç‡ | 100% |
| æ¨ç†å»¶è¿Ÿ (C++) | ~1Î¼s |
| æ¨¡å‹å¤§å° | 835 bytes |
| è®¡ç®—é‡ | 832 MACs |

### RTLä¼°ç®—ï¼ˆä¸²è¡Œå®ç°ï¼‰

| èµ„æº | æ•°é‡ |
|-----|-----|
| 8Ã—8ä¹˜æ³•å™¨ | 1 |
| 24-bitç´¯åŠ å™¨ | 1 |
| ROM (æƒé‡) | ~800 bytes |
| å‘¨æœŸæ•° | ~800 |
| åŠŸè€— (@100MHz) | ~1mW |

## ğŸ“ å­¦ä¹ è·¯å¾„

1. **ç†è§£é‡åŒ–åŸç†** â†’ é˜…è¯» `README.md`
2. **è¿è¡Œç¤ºä¾‹** â†’ `./inference_uint8`
3. **æŸ¥çœ‹æƒé‡** â†’ `cat weights_uint8.bin.txt`
4. **ä¿®æ”¹ç½‘ç»œ** â†’ ç¼–è¾‘ `train_simple.py`
5. **é‡æ–°è®­ç»ƒ** â†’ `python train_simple.py`
6. **éªŒè¯C++** â†’ `make && ./inference_uint8`
7. **å­¦ä¹ RTL** â†’ é˜…è¯» `uint8_nn_rtl.v`
8. **ä»¿çœŸéªŒè¯** â†’ ç”¨ä½ å–œæ¬¢çš„ä»¿çœŸå™¨
9. **FPGAå®ç°** â†’ ç»¼åˆåˆ°FPGA
10. **ä¼˜åŒ–æ€§èƒ½** â†’ å¹¶è¡ŒåŒ–ã€æµæ°´çº¿

## ğŸ” è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹é‡åŒ–åçš„æƒé‡

```bash
head -30 weights_uint8.bin.txt
```

### å¯¹æ¯”Pythonå’ŒC++æ¨ç†ç»“æœ

```python
# åœ¨train_simple.pyä¸­æ·»åŠ 
test_input = X[0]
print("Pythoné¢„æµ‹:", np.argmax(model.forward(test_input.reshape(1,-1))))
```

```cpp
// åœ¨C++ä¸­ä½¿ç”¨ç›¸åŒè¾“å…¥
std::vector<uint8_t> test_input = {...};  // ä»Pythonå¤åˆ¶
int result = nn.inference(test_input);
std::cout << "C++é¢„æµ‹: " << result << std::endl;
```

### æ£€æŸ¥ä¸­é—´å±‚è¾“å‡º

åœ¨ `inference_uint8.cpp` ä¸­æ·»åŠ ï¼š

```cpp
// Layer 1è¾“å‡ºå
for (int i = 0; i < HIDDEN_DIM; i++) {
    std::cout << "hidden[" << i << "] = " 
              << (int)hidden[i] << std::endl;
}
```

## ğŸŒŸ ä¸‹ä¸€æ­¥

### æå‡ç²¾åº¦
- å¢åŠ éšè—å±‚ç¥ç»å…ƒæ•°ï¼ˆ16â†’32â†’64ï¼‰
- ä½¿ç”¨æ›´å¤šè®­ç»ƒæ•°æ®
- è°ƒæ•´å­¦ä¹ ç‡å’Œè®­ç»ƒè½®æ•°
- å°è¯•ä¸åŒçš„æ¿€æ´»å‡½æ•°

### ç¡¬ä»¶ä¼˜åŒ–
- å®ç°æµæ°´çº¿è®¾è®¡
- ä½¿ç”¨DSPå—ï¼ˆFPGAï¼‰
- æƒé‡å‹ç¼©ï¼ˆç¨€ç–åŒ–ï¼‰
- æ··åˆç²¾åº¦ï¼ˆæƒé‡uint8ï¼Œæ¿€æ´»uint16ï¼‰

### åŠŸèƒ½æ‰©å±•
- æ”¯æŒæ›´å¤§çš„å›¾åƒï¼ˆ32Ã—32åƒç´ ï¼‰
- å·ç§¯ç¥ç»ç½‘ç»œï¼ˆCNNï¼‰
- Batch Normalization
- å¤šå±‚ç½‘ç»œï¼ˆ3-5å±‚ï¼‰

## ğŸ“š å‚è€ƒèµ„æ–™

**è®ºæ–‡**:
- [Quantization and Training of Neural Networks](https://arxiv.org/abs/1712.05877)
- [FINN: Binarized Neural Network](https://arxiv.org/abs/1612.07119)

**åœ¨çº¿èµ„æº**:
- NVIDIA TensorRTé‡åŒ–æ–‡æ¡£
- Google TPUè®¾è®¡ç™½çš®ä¹¦
- RISC-V Vector Extension

## ğŸ’¬ å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆå‡†ç¡®ç‡æ˜¯100%ï¼Ÿ**  
A: è¿™æ˜¯ä¸€ä¸ªç®€å•çš„åˆæˆæ•°æ®é›†ã€‚çœŸå®æ•°æ®ä¼šæœ‰æ›´å¤šå™ªå£°å’Œå¤æ‚æ€§ã€‚

**Q: å¯ä»¥ç”¨int4æˆ–int2å—ï¼Ÿ**  
A: å¯ä»¥ï¼ä½†éœ€è¦æ›´ä»”ç»†çš„é‡åŒ–è®­ç»ƒå’Œç²¾åº¦éªŒè¯ã€‚

**Q: å¦‚ä½•è½¬æ¢åˆ°FPGAï¼Ÿ**  
A: ä½¿ç”¨Vivado/Quartusç­‰å·¥å…·ç»¼åˆ `uint8_nn_rtl.v`ï¼Œæ·»åŠ testbenchéªŒè¯ã€‚

**Q: C++æ¨ç†å¤Ÿå¿«å—ï¼Ÿ**  
A: å¯¹äºåµŒå…¥å¼ç³»ç»Ÿå·²ç»å¾ˆå¿«ã€‚å¦‚æœéœ€è¦æ›´é«˜ååé‡ï¼Œè€ƒè™‘RTLå®ç°ã€‚

## âœ¨ æ€»ç»“

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†ï¼š
âœ… å®Œæ•´çš„é‡åŒ–ç¥ç»ç½‘ç»œè®­ç»ƒæµç¨‹  
âœ… ä»æµ®ç‚¹åˆ°uint8çš„æƒé‡è½¬æ¢  
âœ… C++æ¨ç†å¼•æ“å®ç°  
âœ… RTLç¡¬ä»¶è®¾è®¡å‚è€ƒ  
âœ… ç«¯åˆ°ç«¯çš„éªŒè¯æ–¹æ³•

ç°åœ¨ä½ å¯ä»¥ï¼š
1. ç”¨è‡ªå·±çš„æ•°æ®è®­ç»ƒ
2. éƒ¨ç½²åˆ°åµŒå…¥å¼è®¾å¤‡
3. å®ç°åœ¨FPGA/ASICä¸Š
4. ä¼˜åŒ–æ€§èƒ½å’ŒåŠŸè€—

ç¥ä½ æˆåŠŸï¼ğŸ‰
